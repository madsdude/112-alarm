{% extends "base.html" %}
{% block content %}
<div class="split-grid">
  <section class="card">
    <h2 class="section-title">Åbne hændelser</h2>
    <div class="stack">
      {% if active_incidents %}
        {% for inc in active_incidents %}
          <div class="incident-card">
            <div class="incident-main">
              <div>
                <div class="incident-meta">#{{ inc.id }} • {{ inc.city }}</div>
                <div class="incident-heading">
                  <span class="incident-type">{{ inc.type|capitalize }}</span>
                  <span class="incident-badge">Sværhedsgrad: {{ inc.severity }}</span>
                  <span class="incident-badge">Status: <span class="status status-{{ inc.status }}">{{ inc.status }}</span></span>
                </div>
                <div class="incident-req">Krav – Brand: {{ inc.need_fire }}, Ambulance: {{ inc.need_ambulance }}</div>
              </div>
              <form method="post" action="/dispatch" class="dispatch-form">
                <input type="hidden" name="incident_id" value="{{ inc.id }}" />
                <label class="sr-only" for="unit-select-{{ inc.id }}">Vælg enhed</label>
                <select id="unit-select-{{ inc.id }}" name="unit_id" class="input-select" {% if not available_units %}disabled{% endif %}>
                  {% if available_units %}
                    {% for unit in available_units %}
                      <option value="{{ unit.id }}">{{ unit.name }} ({{ unit.kind }})</option>
                    {% endfor %}
                  {% else %}
                    <option disabled>Ingen ledige enheder</option>
                  {% endif %}
                </select>
                <button type="submit" class="button" {% if not available_units %}disabled{% endif %}>Dispatch</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">Ingen åbne hændelser lige nu.</div>
      {% endif %}
    </div>
  </section>

  <section class="card">
    <h2 class="section-title">Enheder</h2>
    <div class="unit-grid">
      {% if units %}
        {% for unit in units %}
          <div class="unit-card">
            <div class="unit-name">{{ unit.name }}</div>
            <div class="unit-info">Type: <span class="unit-type">{{ unit.kind }}</span></div>
            <div class="unit-status">Status: <span class="status status-{{ unit.status }}">{{ unit.status }}</span></div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">Ingen enheder er oprettet endnu.</div>
      {% endif %}
    </div>
  </section>
</div>

<section class="split-grid secondary-grid">
  <div class="card">
    <h3 class="section-title">Historik</h3>
    <ul class="history-list">
      {% if history_incidents %}
        {% for inc in history_incidents %}
          <li>#{{ inc.id }} – {{ inc.type }} i {{ inc.city }} → <span class="status status-{{ inc.status }}">{{ inc.status }}</span></li>
        {% endfor %}
      {% else %}
        <li class="empty-state">Ingen historik endnu.</li>
      {% endif %}
    </ul>
  </div>
  <div class="card">
    <h3 class="section-title">Dev</h3>
    <a href="/admin/reset" class="button button-secondary">Reset/seed</a>
    <p class="caption">Hændelser spawner automatisk ca. hver 45s. Systemet tjekker status hvert 10s.</p>
  </div>
</section>
{% endblock %}
